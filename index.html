<!DOCTYPE html>
<html>
<head>
  <title>Weather</title>
  <meta charset="utf-8">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
  
  
  <link rel="stylesheet" type="text/css" href="css/main.css">
  <script src="js/script.js"></script>
  
  <script type="text/javascript">
    var auth = "";
	//var vart = "Sana,YE";
		  
	$(document).ready(function() {
		//$("button").click(function() {
		
	//hämta position
	getLocation();
		
	 
	//	}); /************click******************/
		

		function getLocation() {
			if (navigator.geolocation) {
				navigator.geolocation.getCurrentPosition(showPosition);
			} 
			else 
				x.innerHTML = "Geolocation is not supported by this browser.";
		};
	
		//sätt in anv position i variabler som ska anv för att ta fram vädret
		function showPosition(position) {
			//https://api.aerisapi.com/observations/59.3133135, 18.0914279?client_id=2DLZxkOpvYq3SA8X4Ny4s&client_secret=h3ado5fV7TbT7RTvDsEnrat6hHBmCHHhypZFUPvM
			var la_ =  position.coords.latitude;
			var lo_= position.coords.longitude;
			//	 la_ =  59.3133135;
			//lo_= 18.0914279;
			//console.log(la_+" "+lo_);
			loadWeatherData(la_, lo_);
		};
		
		//hämta väderdata
		function loadWeatherData(lat, lon) {
			$.ajax({
			url: "https://api.aerisapi.com/observations/" + lat + "," + lon + "?client_id=2DLZxkOpvYq3SA8X4Ny4s&client_secret=h3ado5fV7TbT7RTvDsEnrat6hHBmCHHhypZFUPvM",
         //url: "https://api.aerisapi.com/observations/"+vart+"%20CA?client_id=2DLZxkOpvYq3SA8X4Ny4s&client_secret=h3ado5fV7TbT7RTvDsEnrat6hHBmCHHhypZFUPvM",
			dataType: "jsonp",
			success: function(json) {
		 
				if (json.success == true) {
					var ob = json.response.ob;
					//sätt resultat till varibale som anropar författar metod
					var vader = ob.weather.toLowerCase();
							//console.log(JSON.stringify(vader));
					//getAuthor(JSON.stringify(vader));
					getAuthor(vader);
					$('#hej').html(vader + ' with a temperature of ' + ob.tempC + '°' + ' ');
            }
            else {
               alert('An error occurred: ' + json.error.description);
            }
         }
      });
	  };
	  
	  /*
	  function loadWeatherData(lat, lon){
	  var weathers = "https://api.aerisapi.com/observations/" + lat + "," + lon + "?client_id=2DLZxkOpvYq3SA8X4Ny4s&client_secret=h3ado5fV7TbT7RTvDsEnrat6hHBmCHHhypZFUPvM";
		$.getJSON(weathers).then(function(data) {
				var ob = data.response.ob;
						console.log(ob.weather);
       		var vader = ob.weather.toLowerCase();
			console.log("vader "+vader);
					getAuthor(vader);
					$('#hej').html(vader + ' with a temperature of ' + ob.tempC + '°' + ' ');
    })
    .fail(function() {
        // ...didn't work, handle it
    });
	*/
	/*
	$.getJSON(webDataUrl, function(data) {
    .then(function(data) {
        // ...worked, put it in #view-web
    })
    .fail(function() {
        // ...didn't work, handle it
    });
	  };*/
	  
	  //beroene på väder kommer olika författare och bok väljas
	  function getAuthor(vader){
	  
	  console.log(vader);
	console.log(vader.includes("mostly" && "sunny"));
	   var rand;
	   var tmp;
			if (vader.includes("clear" || "sunny" || "fair"))
			{
				auth = "August+Strindberg";
				$("#my_image").attr("src","img/sol.png");
				}
			else if (vader.includes(("mostly" && "sunny") || ("mostly" && "clear"))) //("mostly clear" || "mostly sunny"))
			{
			   auth = "Karin+Boye";
				$("#my_image").attr("src","img/halv_sol.png");
			
			   }
			else if (vader.includes("mostly" && "cloudy"))
			{
			    auth = "Stig+Dagerman";
				$("#my_image").attr("src","img/halv_moln.png");
				}
			else if (vader.includes("cloudy"))
			{
			    auth = "Bodil+Malmsten";
				$("#my_image").attr("src","img/moln.png");
				}
			else 
			{
				auth = "Kerstin+Ekman";
				$("#my_image").attr("src","img/dark_moln.png");
				}
				
			//var f = "https://libris.kb.se/xsearch?query=Bodil+Malmsten&n=5&format=json";
				 
			//sök efter förfatare på kb
			//var f = "https://libris.kb.se/xsearch?query="+auth+"&n=10&format=json";
			var f = "https://libris.kb.se/xsearch?query="+auth+"&n=5&format=json";
			$.getJSON(f, 
				function(data) {
						
					var arr;
		//var test = data;
			//	var result = [];

//for(var i in data)
  //  result.push([i, data[i]])		
			//console.log("Resuklt "+result.from);
			//var obj = JSON.parse(data);
			
				//		var arr = result.filter(function(el) {
					//return el.identifier === "E-book";
				//});

				//console.log("borta" + JSON.stringify(arr, null, ' '));
				/*
				var ett = data.xsearch.list[0].title.toString();
				var tva = data.xsearch.list[1].title.toString();
				var tre = data.xsearch.list[2].title.toString();
				var fyra = data.xsearch.list[3].title.toString();
				var fem = data.xsearch.list[4].title.toString();
				arr = [ett, tva, tre, fyra, fem];
				var qw= "Elektronisk";
				
				//if (ett.length)
				if(ett.includes("Elektronisk"))
					console.log("hej"+ett);
				*/
				/*
				var s = "foo",
    su= "oo";
	if(s.includes(su))
		console.log("hej "+su);
		else 
			console.log("hej");
		*/
				rand = Math.floor((Math.random() * (data.xsearch.list.length)-1));
			
							//console.log(JSON.stringify(test));
							
					//$("#hej").append(data.xsearch.from);
					
			//	$.each(data.xsearch.list, function(i, obj) {
					//console.log("i "+i);
					//var arr = JSON.stringify(data.xsearch.list);
			//console.log("test "+data.xsearch.list[i].title);
			 /* 	for(var i in data.xsearch.list)
						{
							//arr.push(obj.title[i]);
							//post += "<li>" + obj.tags[i] + "</li>";
							arr += data.xsearch.list.title[i];
						}*/
			  
			  //arr.push(data.xsearch.list);
			// arr+=obj.title[i];
				//rand=i;
				//console.log(arr);
				//console.log(arr.length);
		
			//tmp = obj.title.split(",");
				//console.log("hej"+rand);
				//});
					//console.log("Ett "+arr);
			// rand = tmp[Math.floor(Math.random() * rand)];
			
				//console.log("st "+data.xsearch.list.length);
					
					
				/*
				if (rand instanceof Array) {
  alert('value is Array!');
} else {
  alert('Not an array');
}
			*/	
						/*var post = "<article>";
						post += "<h1>" + obj.title + "</h1>";
						post += "<p>" + obj.creator + "</p>";
						post += "<ul>";
						//for(var i in obj.tags)
						//{
							//post += "<li>" + obj.tags[i] + "</li>";
						//}
						post += "</ul>";
						post += "</article>";*/
						
						//appenda första boken
			
						
					
								$("#blogposts").append(data.xsearch.list[0].title + " Av "+auth.replace("+", " "));
					
			});
			};
			
			
	});
	

	</script>
</head>
<body>
<div class="container">
<button type="button" class="btn btn-primary btn-lg">Test</button>
	<h3>Today when the current weather is</h3>
		<div id="hej"></div>
		<img id="my_image" src=""/>
		<h3>Maybe this book could be nice to read:</h3>
		<div id="blogposts"></div>
			<div id="theDiv"></div>
			


<!-- <a href="svdTest.html">Nobelpris</a> -->
</body>
</html
