<!DOCTYPE html>
<html>
<head>
  <title>Weather</title>
  <meta charset="utf-8">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
  <!-- <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script> -->
  
  
  <link rel="stylesheet" type="text/css" href="css/main.css">
  <script src="js/script.js"></script>
  
  <script type="text/javascript">
    var auth = "";
	var vart = "Stockholm,SE";
	var stad="";
		  
	$(document).ready(function() {
	//getTown();
	getStad();
	//getSthlmVader(vart);

/*
	function getTown(){
		var sweden ="https://api.aerisapi.com/countries/se?client_id=2DLZxkOpvYq3SA8X4Ny4s&client_secret=h3ado5fV7TbT7RTvDsEnrat6hHBmCHHhypZFUPvM";
		$.getJSON(sweden).then(function(data) {
				stad = data.response.profile.capital;
					console.log("stad "+stad);
				//getSthlm(stad);
       		//var sthlm_v = obe.weather.toLowerCase();
			//console.log("vader "+vader);
					//getAuthor(vader);
					
					getSthlmVader(JSON.parse(stad));
					//$('#sthlm').append(sthlm_v + ' with a temperature of ' + obe.tempC + '°' + ' ');
				//$('#sthlm').append('Temperature ' + obe.tempC + '°' + ' ');
    })
    .fail(function() {
        alert('Error: ' + json.error.description);
    });
	}

	
	//console.log("stad "+stad);
	function getSthlmVader(stad){
	var s=stad;
	var sthlm ="https://api.aerisapi.com/observations/"+s +"?client_id=2DLZxkOpvYq3SA8X4Ny4s&client_secret=h3ado5fV7TbT7RTvDsEnrat6hHBmCHHhypZFUPvM";
		$.getJSON(sthlm).then(function(data) {
				var obe = data.response.ob;
						console.log("sthlm"+obe.weather);
       		var sthlm_v = obe.weather.toLowerCase();
			//console.log("vader "+vader);
					//getAuthor(vader);
					
					//$('#sthlm').append(sthlm_v + ' with a temperature of ' + obe.tempC + '°' + ' ');
				$('#sthlm').append('Temperature ' + obe.tempC + '°' + ' ');
    })
    .fail(function() {
        alert('Error: ' + json.error.description);
    });
	};
		*/	
	/*******************/

	
	
		$("button").click(function() {
		
	//hämta position
	getLocation();
		
		
		
	 
}); /************click******************/
		

		function getLocation() {
			if (navigator.geolocation) {
				navigator.geolocation.getCurrentPosition(showPosition);
			} 
			else 
				x.innerHTML = "Geolocation is not supported by this browser.";
		};
	
		//sätt in anv position i variabler som ska anv för att ta fram vädret
		function showPosition(position) {
			//https://api.aerisapi.com/observations/59.3133135, 18.0914279?client_id=2DLZxkOpvYq3SA8X4Ny4s&client_secret=h3ado5fV7TbT7RTvDsEnrat6hHBmCHHhypZFUPvM
			var la_ =  position.coords.latitude;
			var lo_= position.coords.longitude;
			//	 la_ =  59.3133135;
			//lo_= 18.0914279;
			//console.log(la_+" "+lo_);
			loadWeatherData(la_, lo_);
		};
	
	  
	  function loadWeatherData(lat, lon){
	  var weathers = "https://api.aerisapi.com/observations/" + lat + "," + lon + "?client_id=2DLZxkOpvYq3SA8X4Ny4s&client_secret=h3ado5fV7TbT7RTvDsEnrat6hHBmCHHhypZFUPvM";
		$.getJSON(weathers).then(function(data) {
				var ob = data.response.ob;
						//console.log(ob.weather);
       		var vader = ob.weather.toLowerCase();
			//console.log("vader "+vader);
					getAuthor(vader);
					$('#foreCast').append('Today when the current weather is '+ vader + ' with a temperature of ' + ob.tempC + '°' + ' ');
    })
    .fail(function() {
        alert('Error: ' + json.error.description);
    });

	  	};
		
						  function getStad(){
			  //var vart = "Stockholm,SE";
	var sweden ="https://api.aerisapi.com/countries/se?client_id=2DLZxkOpvYq3SA8X4Ny4s&client_secret=h3ado5fV7TbT7RTvDsEnrat6hHBmCHHhypZFUPvM";
		$.getJSON(sweden).then(function(data) {
				var ob = data.response.ob;
					var stad = data.response.profile.capital.toLowerCase();
					var iso = data.response.place.iso.toLowerCase();
					console.log("stad "+ typeof stad +" iso "+ typeof iso);
					
		var s = "https://api.aerisapi.com/observations/" + stad + "," +iso+ "?client_id=2DLZxkOpvYq3SA8X4Ny4s&client_secret=h3ado5fV7TbT7RTvDsEnrat6hHBmCHHhypZFUPvM";
						
//var s ="https://api.aerisapi.com/observations/stockholm,se?client_id=2DLZxkOpvYq3SA8X4Ny4s&client_secret=h3ado5fV7TbT7RTvDsEnrat6hHBmCHHhypZFUPvM";
						$.getJSON(s).then(function(data) {
				var obe = data.response.ob;
						//console.log(ob.weather);
       		var vad = obe.weather.toLowerCase();
			//console.log("vader "+vader);
			
					//getAuthor(vader);
						$('#sthlm').append('Temperature in ' + stad + " " + obe.tempC + '°' + ' ');
					//$('#foreCast').append('Today when the current weather is '+ vader + ' with a temperature of ' + ob.tempC + '°' + ' ');
    });
	
			var sm = "https://api.aerisapi.com/sunmoon/" + stad + "," +iso+ "?client_id=2DLZxkOpvYq3SA8X4Ny4s&client_secret=h3ado5fV7TbT7RTvDsEnrat6hHBmCHHhypZFUPvM";
						
//var s ="https://api.aerisapi.com/observations/stockholm,se?client_id=2DLZxkOpvYq3SA8X4Ny4s&client_secret=h3ado5fV7TbT7RTvDsEnrat6hHBmCHHhypZFUPvM";
						$.getJSON(sm).then(function(data) {
				//var ts = data.response[0].dateTimeISO;
				var solupp = data.response[0].sun.riseISO;
				var solner = data.response[0].sun.setISO;
				//var uu=ts.
						console.log(solupp+ " "+solner);
						
						//data.xsearch.list[rand].title
       		//var vad = obe.weather.toLowerCase();
			//console.log("vader "+vader);
			
					//getAuthor(vader);
						//$('#sthlm').append('Temperature in ' + stad + " " + obe.tempC + '°' + ' ');
					//$('#foreCast').append('Today when the current weather is '+ vader + ' with a temperature of ' + ob.tempC + '°' + ' ');
    });
	
	
	
							//getSthlmVader(JSON.parse(stad));
							//getSthlmVader(stad+","+iso);
						//console.log(ob.weather);
       		//var vad = ob.weather.toLowerCase();
			//console.log("vader "+vader);
			
					//getAuthor(vader);
						//$('#sthlm').append('Temperature ' + ob.tempC + '°' + ' ');
					//$('#foreCast').append('Today when the current weather is '+ vader + ' with a temperature of ' + ob.tempC + '°' + ' ');
    })
    .fail(function() {
        alert('Error: ' + json.error.description);
    });

	  	};
		
		
			  function getSthlmVader(vart){
			  //var vart = "Stockholm,SE";
	  var s = "https://api.aerisapi.com/observations/" + vart + "?client_id=2DLZxkOpvYq3SA8X4Ny4s&client_secret=h3ado5fV7TbT7RTvDsEnrat6hHBmCHHhypZFUPvM";
		$.getJSON(s).then(function(data) {
				var ob = data.response.ob;
						//console.log(ob.weather);
       		var vad = ob.weather.toLowerCase();
			//console.log("vader "+vader);
			
					//getAuthor(vader);
						$('#sthlm').append('Temperature ' + ob.tempC + '°' + ' ');
					//$('#foreCast').append('Today when the current weather is '+ vader + ' with a temperature of ' + ob.tempC + '°' + ' ');
    })
    .fail(function() {
        alert('Error: ' + json.error.description);
    });

	  	};
		

		
		
		
	  //beroene på väder kommer olika författare och bok väljas
	  function getAuthor(vader){
	  
	  console.log(vader);
	console.log(vader.includes("mostly" && "sunny"));
	   var rand;
	   var tmp;
			if (vader.includes("sunny" || "fair"))
			{
				auth = "August+Strindberg";
				$("#my_image").attr("src","img/sun.png");
				}
			else if (vader.includes(("mostly" && "sunny") || ("mostly" && "clear"))) //("mostly clear" || "mostly sunny"))
			{
			   auth = "Karin+Boye";
				$("#my_image").attr("src","img/p_sun.png");
			
			   }
			else if (vader.includes("mostly" && "cloudy"))
			{
			    auth = "Stig+Dagerman";
				$("#my_image").attr("src","img/p_cloud.png");
				}
			else if (vader.includes("cloudy"))
			{
			    auth = "Bodil+Malmsten";
				$("#my_image").attr("src","img/cloudy.png");
				}
				
			else if (vader.includes("clear"))
			{
			    auth = "P.C.+Jersild";
				$("#my_image").attr("src","img/clear.png");
				}
			else 
			{
				auth = "Kerstin+Ekman";
				$("#my_image").attr("src","img/d_cloud.png");
				}
				
			//var f = "https://libris.kb.se/xsearch?query=Bodil+Malmsten&n=5&format=json";
				 
			//sök efter förfatare på kb
			//var f = "https://libris.kb.se/xsearch?query="+auth+"&n=10&format=json";
			var f = "https://libris.kb.se/xsearch?query="+auth+"&n=5&format=json";
			$.getJSON(f, 
				function(data) {
					console.log(data.xsearch.list.length);
						rand = Math.floor((Math.random() * (data.xsearch.list.length)-1));
						if(rand<=-1)rand=0;
							console.log("rand" +rand);
							$("#bookAndAuthor").append("Maybe this book could be nice to read: " + data.xsearch.list[rand].title + " By "+auth.replace("+", " "));
	
			});
			};
		
	});
	

	</script>
</head>
<body>

<div class="container">
  <h2>Weather and Books</h2>
  <p>There is no bad weather, only bad books</p>


			  <ul class="nav nav-tabs">
    <li class="active"><a data-toggle="tab" href="#home">Home</a></li>
    <li><a data-toggle="tab" href="#menu1">Local</a></li>
    <li><a data-toggle="tab" href="#menu2">Links</a></li>
    <li><a data-toggle="tab" href="#menu3">About</a></li>
  </ul>

  <div class="tab-content">
    <div id="home" class="tab-pane fade in active">
	
      <section ">
<div class="container">
<div class="row text-center">
     <h2>Select your city</h2>
	
	 <figure class="col-xs-6">
	 
	 
	 <h3>Stockholm</h3>
	 <a href="rr.html">
	
	 <img class="img-responsive" id="open" src="img/sun.png" alt="Birdys Russian Roulette" width="384" height="384" 
	 onclick="window.open('rr.html', 'newwindow', 'width=400', height='400'); return false;"></a>
	  <h3 id="sthlm"></h3>
	 </figure>

     <figure class="col-xs-6">
 <h3>Göteborg</h3>
	 <img class="img-responsive" src="img/sun.png" alt="Birdy Cola" width="384" height="384">
	  <h3>Stockholm</h3>
    </figure>
	
	
	<figure class="col-xs-6">
	 <h3>Malmö</h3>
	<img class="img-responsive" src="img/sun.png" alt="Sharky" width="384" height="384">
	 <h3>Stockholm</h3>
	</figure>
	<figure class="col-xs-6">
	
 <h3>Kiruna</h3>
	<img class="img-responsive" src="img/sun.png" alt="Castle" width="384" height="384">
	 <h3>Stockholm</h3>
 </figure>
 </div>
 </div>
</section>
	
      
    </div>
    <div id="menu1" class="tab-pane fade">
      <h3>Please press button for a weather cast and a book tip from your location!</h3>
	  	  
		<div id="foreCast"></div>
		<img id="my_image" src="img/quest.png"/>

		<div id="bookAndAuthor"></div>
	  <button type="button" class="btn btn-primary btn-lg">Weather & Books</button> 

    </div>
    <div id="menu2" class="tab-pane fade">
      <h3>Game</h3>
      <p>Test</p> <a href="test.html">testa</a> 
    </div>
    <div id="menu3" class="tab-pane fade">
      <h3>Menu 3</h3>
      <p> This site use Aerisapi Api (www.aerisapi.com), Flickr Api, Geolocation Api and Libris Api</p>
    </div>
  </div>
</div>



</body>
</html
